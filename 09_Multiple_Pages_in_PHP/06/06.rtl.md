# 📚 جزوه آموزشی: سازماندهی کد و افزایش امنیت در PHP

## 🎯 هدف این جلسه
یادگیری نحوه سازماندهی کدها و افزایش امنیت وبسایت با ایجاد پوشه `includes`

---

## 📁 ساختار جدید فایل‌ها

### قبل از سازماندهی:
```
root/
├── index.php
├── article.php
├── header.php
├── footer.php
└── database.php
```

### بعد از سازماندهی:
```
root/
├── index.php
├── article.php
└── includes/
    ├── header.php
    ├── footer.php
    ├── database.php
    └── .htaccess
```

---

## 🔧 تغییرات انجام شده

### 1. ایجاد پوشه `includes`
- تمام فایل‌های فرعی به این پوشه منتقل شدند
- این کار کدها را مرتب‌تر می‌کند

### 2. تغییر مسیر requireها
**قبل:**
```php
require 'header.php';
require 'database.php';
require 'footer.php';
```

**بعد:**
```php
require 'includes/header.php';
require 'includes/database.php';
require 'includes/footer.php';
```

---

## 🛡️ بخش امنیتی - مهم!

### مشکل امنیتی کشف شده:
اگر سرور به درستی تنظیم نباشد و PHP کار نکند، فایل‌های PHP به صورت متن ساده نمایش داده می‌شوند!

**مثال خطرناک:**
```
http://localhost/includes/database.php
```
اگر PHP کار نکند، پسورد دیتابیس شما لو می‌رود!

### راه حل: فایل `.htaccess`

```apache
# فایل: includes/.htaccess
deny from all
```

**کار این فایل:**
- دسترسی مستقیم به تمام فایل‌های داخل پوشه `includes` را مسدود می‌کند
- فقط از طریق `require` در PHP قابل دسترسی هستند

---

## 📝 کدهای به روز شده

### فایل index.php (به روز شده)
```php
<?php
require 'includes/database.php';

$sql = "SELECT * FROM article ORDER BY published_at;";
$results = mysqli_query($conn, $sql);

if ($results === false) {
    echo mysqli_error($conn);
} else {
    $articles = mysqli_fetch_all($results, MYSQLI_ASSOC);
}
?>

<?php require 'includes/header.php'; ?>

<?php if (empty($articles)): ?>
    <p>No articles found.</p>
<?php else: ?>
    <ul>
        <?php foreach ($articles as $article): ?>
            <li>
                <article>
                    <h2>
                        <a href="article.php?id=<?= $article['id']; ?>">
                            <?= $article['title']; ?>
                        </a>
                    </h2>
                    <p><?= $article['content']; ?></p>
                </article>
            </li>
        <?php endforeach; ?>
    </ul>
<?php endif; ?>

<?php require 'includes/footer.php'; ?>
```

### فایل article.php (به روز شده)
```php
<?php
require 'includes/database.php';

if (isset($_GET['id']) && is_numeric($_GET['id'])) {
    $sql = "SELECT * FROM article WHERE id = " . $_GET['id'];
    $results = mysqli_query($conn, $sql);
    
    if ($results === false) {
        echo mysqli_error($conn);
    } else {
        $article = mysqli_fetch_assoc($results);
    }
} else {
    $article = null;
}
?>

<?php require 'includes/header.php'; ?>

<?php if ($article === null): ?>
    <p>Article not found.</p>
<?php else: ?>
    <article>
        <h2><?= $article['title']; ?></h2>
        <p><?= $article['content']; ?></p>
    </article>
<?php endif; ?>

<?php require 'includes/footer.php'; ?>
```

---

## 🎓 مفاهیم مهم برای یادگیری

### 1. سازماندهی کد (Code Organization)
- **چرا؟** کد تمیز‌تر، نگهداری آسان‌تر
- **چگونه؟** با جدا کردن فایل‌های مختلف در پوشه‌های مرتبط

### 2. امنیت (Security)
- **تهدید:** نمایش کدهای PHP به صورت متن ساده
- **حل:** استفاده از `.htaccess` برای مسدود کردن دسترسی مستقیم

### 3. مسیردهی (Path Management)
- **نکته:** وقتی فایل‌ها را جابه‌جا می‌کنیم، باید مسیر requireها را به روز کنیم

---

## ⚠️ نکات فنی مهم

### درباره فایل .htaccess
- فقط روی سرور Apache کار می‌کند
- اگر از سرور دیگری استفاده می‌کنید، روش متفاوت است
- فایل باید دقیقاً با نام `.htaccess` ذخیره شود

### تست امنیتی
پس از ایجاد فایل `.htaccess` آدرس زیر باید **خطای 403** بدهد:
```
http://localhost/includes/database.php
```

---

## 🚀 مراحل عملی برای پیاده‌سازی

### مرحله ۱: ایجاد پوشه
```bash
# در پوشه اصلی پروژه
mkdir includes
```

### مرحله ۲: انتقال فایل‌ها
- `header.php` → `includes/header.php`
- `footer.php` → `includes/footer.php` 
- `database.php` → `includes/database.php`

### مرحله ۳: به روز کردن requireها
در تمام فایل‌های PHP، مسیر requireها را تغییر دهید

### مرحله ۴: ایجاد فایل امنیتی
```bash
# در پوشه includes
touch .htaccess
```
و محتوای زیر را در آن قرار دهید:
```apache
deny from all
```

---

## ✅ خلاصه یادگیری

| کاری که انجام دادیم | فایده آن |
|-------------------|----------|
| ایجاد پوشه `includes` | سازماندهی بهتر کد |
| تغییر مسیر requireها | تطبیق با ساختار جدید |
| ایجاد `.htaccess` | جلوگیری از دسترسی مستقیم به فایل‌های حساس |

---

## 🔮 تمرین‌های بعدی

1. **تمرین سازماندهی:** یک پوشه `css` برای فایل‌های استایل ایجاد کنید
2. **تمرین امنیتی:** فایل `.htaccess` را تست کنید و مطمئن شوید کار می‌کند
3. **تمرین کدنویسی:** یک فایل `config.php` برای تنظیمات ایجاد کنید

---

## 🎉 نتیجه نهایی
با انجام این تغییرات:
- ✅ کدهای شما مرتب‌تر شد
- ✅ امنیت وبسایت افزایش یافت  
- ✅ نگهداری پروژه آسان‌تر شد

**به یاد داشته باشید:** سازماندهی کد و امنیت دو رکن مهم در برنامه‌نویسی حرفه‌ای هستند!

---
*📖 منبع: آموزش‌های ویدیویی PHP - سازماندهی کد و امنیت*