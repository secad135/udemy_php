# ุฌุฒูู: ุจุฑุฑุณ ุงููุช ุฏุฑ Query String ู ุฌููฺฏุฑ ุงุฒ SQL Injection ุฏุฑ PHP

ุฏุฑ ุงู ุฌูุณู ุงุฏ ูโฺฏุฑู ฺฺฏููู ููุฏุงุฑ `id` ุฑุง ุงุฒ Query String ุฏุฑุงูุช ฺฉููุ ุขู ุฑุง ุฏุฑ SQL ุงุณุชูุงุฏู ฺฉููุ ู ูููโุชุฑ ุงุฒ ุขู โ ฺฺฏููู ุงุฒ ุญูููโ **SQL Injection** ุฌููฺฏุฑ ฺฉูู.

---

## ๐ก ููููู Query String

ุฏุฑ ูุงู `index.php`ุ ููฺฉ ูุฑ ููุงูู ุจู ุตูุฑุช ุฒุฑ ุณุงุฎุชู ูโุดูุฏ:

```php
<a href="article.php?id=<?= $article['id']; ?>">
```

ุจุง ุงู ฺฉุงุฑุ ููุช ุฑู ุนููุงู ููุงูู ฺฉูฺฉ ูโฺฉููุ ููุฏุงุฑ `id` ุจู ุขุฏุฑุณ ุตูุญู ุงุถุงูู ูโุดูุฏุ ูุซูุงู:

```
article.php?id=3
```

ุฏุฑ ุตูุญูโ `article.php`ุ ููุฏุงุฑ `id` ุจุง ุงุณุชูุงุฏู ุงุฒ ุณููพุฑโฺฏููุจุงู `$_GET` ุฏุฑุงูุช ูโุดูุฏ:

```php
$_GET['id']
```

---

## โ๏ธ ุฎุทุฑ SQL Injection

ุฏุฑ ุญุงูุช ุงูููุ ฺฉุฏ ููฺฉู ุงุณุช ุจู ุดฺฉู ุฒุฑ ุจุงุดุฏ:

```php
$sql = "SELECT * FROM article WHERE id = " . $_GET['id'];
```

ุงฺฏุฑ ฺฉุงุฑุจุฑ ููุฏุงุฑ `id` ุฑุง ุฏุฑ ุขุฏุฑุณ ุจู ุตูุฑุช `id=3 OR 1=1` ุชุบุฑ ุฏูุฏุ ฺฉูุฆุฑ ุฎุทุฑูุงฺฉ ุงุฌุงุฏ ูโุดูุฏ ฺฉู ูโุชูุงูุฏ ุจุงุนุซ ููุงุด ุฏุงุฏูโูุง ุบุฑูุฌุงุฒ ุดูุฏ. ุจู ุงู ููุน ุญูููุ **SQL Injection** ฺฏูุชู ูโุดูุฏ.

> โ๏ธ ุจุง ุงู ุฑูุดุ ฺฉุงุฑุจุฑ ูโุชูุงูุฏ ุฏุณุชูุฑุงุช SQL ุฏูุฎูุงู ุฎูุฏ ุฑุง ุฑู ูพุงฺฏุงู ุฏุงุฏู ุงุฌุฑุง ฺฉูุฏ.

ููุจุน: [SQL Injection - PHP Manual](https://www.php.net/manual/en/security.database.sql-injection.php)

---

## ๐งฐ ุฑุงูโุญู ุณุงุฏู: ุจุฑุฑุณ ููุฏุงุฑ ุนุฏุฏ ุจูุฏู

ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุชุฒุฑู SQLุ ุงููู ูุฏู ุจุฑุฑุณ ุนุฏุฏ ุจูุฏู ููุฏุงุฑ `id` ุงุณุช:

```php
if (isset($_GET['id']) && is_numeric($_GET['id'])) {
    $sql = "SELECT * FROM article WHERE id = " . $_GET['id'];
    $results = mysqli_query($conn, $sql);

    if ($results === false) {
        echo mysqli_error($conn);
    } else {
        $article = mysqli_fetch_assoc($results);
    }
} else {
    $article = null;
}
```

### ุชูุถุญ ุชูุงุจุน:

* [`isset()`](https://www.php.net/manual/en/function.isset.php): ุจุฑุฑุณ ูโฺฉูุฏ ุขุง ูุชุบุฑ ุชุนุฑู ุดุฏู ุงุณุช ุง ูู.
* [`is_numeric()`](https://www.php.net/manual/en/function.is-numeric.php): ุจุฑุฑุณ ูโฺฉูุฏ ุขุง ููุฏุงุฑ ุนุฏุฏ ุงุณุช ุง ุฎุฑ.

ุจู ุงู ุชุฑุชุจ ุงฺฏุฑ ฺฉุณ `id=test` ุง `id='DROP TABLE'` ูุงุฑุฏ ฺฉูุฏุ ฺฉูุฆุฑ ุงุฌุฑุง ููโุดูุฏ.

---

## ๐ง ูฺฉุชู ุงููุช ููู

ุญุช ุจุง ุงู ุฑูุด ูู ุงูู ฺฉุงูู ูุฏุงุฑู. ุจูุชุฑู ุฑูุด ุงุณุชูุงุฏู ุงุฒ **Prepared Statements** ุงุณุช ฺฉู ุฏุฑ ุฌูุณุงุช ุจุนุฏ ุขููุฒุด ุฏุงุฏู ูโุดูุฏ.

ุงูุง ุจุฑุง ุงูุงูุ ุจุฑุฑุณ `isset()` ู `is_numeric()` ูุงูุน ุฎุทุงูุง ูุงุฎูุงุณุชู ู ููุงุด ูพุบุงูโูุง ุฎุทุฑูุงฺฉ ุจู ฺฉุงุฑุจุฑ ูโุดูุฏ.

---

## ๐งฑ ููุงุด ุฎุทุงูุง ุฏุฑ ูุญุท ุชูุณุนู ู ุชููุฏ

ุฏุฑ ูุญุท ุชูุณุนูุ ุฏุฏู ุฎุทุงูุง ููุฏ ุงุณุชุ ุงูุง ุฏุฑ ุณุงุชโูุง ูุงูุน (Production) ุจุงุฏ ุงุฒ ููุงุด ูพุงูโูุง ุฎุทุง ุฌููฺฏุฑ ฺฉุฑุฏ ุชุง ุงุทูุงุนุงุช ุณุงุฎุชุงุฑ ูพุงฺฏุงู ุฏุงุฏู ูู ูุฑูุฏ:

```php
ini_set('display_errors', 0);
```

---

## โ ูุชุฌูโฺฏุฑ

| ูุฏู                             | ุฑูุด ุงููโุณุงุฒ                                         |
| ------------------------------- | ----------------------------------------------------- |
| ุฌููฺฏุฑ ุงุฒ ุชุฒุฑู SQL            | ุจุฑุฑุณ `is_numeric()` ู ุงุณุชูุงุฏู ุงุฒ Prepared Statements |
| ุฌููฺฏุฑ ุงุฒ ุฎุทุง Undefined Index | ุจุฑุฑุณ `isset()`                                       |
| ูพููุงูโุณุงุฒ ุฎุทุงูุง ุฏุฑ ุณุฑูุฑ ูุงูุน  | ุบุฑูุนุงู ฺฉุฑุฏู ููุงุด ุฎุทุงูุง                              |

---

### ๐ ููุงุจุน ุฑุณู PHP

* [is_numeric() - PHP Manual](https://www.php.net/manual/en/function.is-numeric.php)
* [isset() - PHP Manual](https://www.php.net/manual/en/function.isset.php)
* [Logical Operators - PHP Manual](https://www.php.net/manual/en/language.operators.logical.php)

---

### ๐ ููููู ููุง ูุงู `article.php`

```php
<?php

$db_host = "localhost";
$db_name = "cms";
$db_user = "cms_www";
$db_pass = "64w6H2rOJ1zwLRyk";

$conn = mysqli_connect($db_host, $db_user, $db_pass, $db_name);

if (mysqli_connect_error()) {
    echo mysqli_connect_error();
    exit;
}

if (isset($_GET['id']) && is_numeric($_GET['id'])) {

    $sql = "SELECT * FROM article WHERE id = " . $_GET['id'];
    $results = mysqli_query($conn, $sql);

    if ($results === false) {
        echo mysqli_error($conn);
    } else {
        $article = mysqli_fetch_assoc($results);
    }

} else {
    $article = null;
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>My blog</title>
    <meta charset="utf-8">
</head>
<body>

<header>
    <h1>My blog</h1>
</header>

<main>
    <?php if ($article === null): ?>
        <p>Article not found.</p>
    <?php else: ?>
        <article>
            <h2><?= $article['title']; ?></h2>
            <p><?= $article['content']; ?></p>
        </article>
    <?php endif; ?>
</main>

</body>
</html>
```

---

โ ุจุง ุงู ุชุบุฑุงุชุ ุงฺฏุฑ ฺฉุงุฑุจุฑ `id` ุฑุง ุญุฐู ุง ุฏุณุชฺฉุงุฑ ฺฉูุฏุ ูพุบุงู ุฎุทุง ููุงุณุจ ููุงุด ุฏุงุฏู ูโุดูุฏ ู ูฺ ุงุทูุงุนุงุช ุญุณุงุณ ูู ููโุฑูุฏ.
