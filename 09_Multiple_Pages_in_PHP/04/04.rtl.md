# جزوه آموزشی: حذف کدهای تکراری با استفاده از Include و Require در PHP

## مقدمه
در توسعه وب، داشتن کدهای تکراری یک مشکل رایج است که می‌تواند منجر به:
- مشکل در نگهداری کد
- خطاهای بیشتر
- اتلاف وقت در به‌روزرسانی

## مشکل کدهای تکراری
در پروژه وبلاگ، دو فایل `index.php` و `article.php` هر دو شامل کد اتصال به دیتابیس بودند.

### کد تکراری اصلی:
```php
<?php
$db_host = "localhost";
$db_name = "cms";
$db_user = "cms_www";
$db_pass = "64w6H2rOJ1zwLRyk";

$conn = mysqli_connect($db_host, $db_user, $db_pass, $db_name);

if (mysqli_connect_error()) {
    echo mysqli_connect_error();
    exit;
}
?>
```

## راه حل: استفاده از فایل‌های جداگانه

### 1. ایجاد فایل database.php
کد اتصال به دیتابیس در یک فایل جداگانه قرار گرفت:

**database.php:**
```php
<?php
$db_host = "localhost";
$db_name = "cms";
$db_user = "cms_www";
$db_pass = "64w6H2rOJ1zwLRyk";

$conn = mysqli_connect($db_host, $db_user, $db_pass, $db_name);

if (mysqli_connect_error()) {
    echo mysqli_connect_error();
    exit;
}
?>
```

### 2. تفاوت‌های include و require

| تابع | رفتار وقتی فایل پیدا نمی‌شود | توصیه |
|------|-----------------------------|--------|
| `include()` | نمایش warning و ادامه اجرا | - |
| `require()` | توقف کامل اسکریپت (Fatal Error) | ✅ توصیه می‌شود |
| `include_once()` | مانند include، اما فقط یکبار include می‌کند | - |
| `require_once()` | مانند require، اما فقط یکبار require می‌کند | - |

### 3. استفاده در فایل‌ها
**در index.php و article.php:**
```php
<?php require 'database.php'; ?>
```

## استخراج بخش‌های HTML تکراری

### 1. ایجاد فایل header.php
**header.php:**
```php
<!DOCTYPE html>
<html>
<head>
    <title>My blog</title>
    <meta charset="utf-8">
</head>
<body>
    <header>
        <h1>My blog</h1>
    </header>
    <main>
```

### 2. ایجاد فایل footer.php
**footer.php:**
```php
    </main>
</body>
</html>
```

### 3. استفاده در فایل‌های اصلی
**index.php (نسخه نهایی):**
```php
<?php require 'database.php'; ?>

<?php
$sql = "SELECT * FROM article ORDER BY published_at;";
$results = mysqli_query($conn, $sql);

if ($results === false) {
    echo mysqli_error($conn);
} else {
    $articles = mysqli_fetch_all($results, MYSQLI_ASSOC);
}
?>

<?php require 'header.php'; ?>

<?php if (empty($articles)): ?>
    <p>No articles found.</p>
<?php else: ?>
    <ul>
        <?php foreach ($articles as $article): ?>
            <li>
                <article>
                    <h2><a href="article.php?id=<?= $article['id']; ?>"><?= $article['title']; ?></a></h2>
                    <p><?= $article['content']; ?></p>
                </article>
            </li>
        <?php endforeach; ?>
    </ul>
<?php endif; ?>

<?php require 'footer.php'; ?>
```

## مزایای این روش

1. **کاهش کدهای تکراری**
2. **نگهداری آسان‌تر** - تغییرات فقط در یک فایل انجام می‌شود
3. **خوانایی بهتر کد**
4. **کاهش احتمال خطا**
5. **سازمان‌دهی بهتر پروژه**

## نکات مهم

- حتی برای فایل‌های HTML هم از پسوند `.php` استفاده می‌کنیم تا در آینده امکان اضافه کردن کد PHP وجود داشته باشد
- `require` نسبت به `include` امن‌تر است چون در صورت عدم پیدا کردن فایل، اجرا متوقف می‌شود
- این روش foundation خوبی برای یادگیری مفاهیم پیشرفته‌تر مانند کلاس‌ها و توابع است