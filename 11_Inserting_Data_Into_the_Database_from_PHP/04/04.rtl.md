# 📚 جزوه: افزودن داده از فرم به دیتابیس (PHP + MySQL)

---

## 🔍 مقدمه

تا اکنون یاد گرفتیم که چگونه با دستور `INSERT INTO` در SQL داده‌های جدید را در جداول وارد کنیم.

🔹 در این بخش یاد می‌گیریم که چگونه این داده‌ها را از یک فرم HTML به دیتابیس ارسال کنیم.

---

## 🗒️ نمونه کد PHP

```php
<?php

if ($_SERVER["REQUEST_METHOD"] == "POST") {

    require 'includes/database.php';

    $sql = "INSERT INTO article (title, content, published_at)
            VALUES ('" . $_POST['title'] . "','"
                       . $_POST['content'] . "','"
                       . $_POST['published_at'] . "')";

    $results = mysqli_query($conn, $sql);

    if ($results === false) {

        echo mysqli_error($conn);

    } else {

        $id = mysqli_insert_id($conn);
        echo "Inserted record with ID: $id";

    }

}
?>
<?php require 'includes/header.php'; ?>

<h2>New article</h2>

<form method="post">

    <div>
        <label for="title">Title</label>
        <input name="title" id="title" placeholder="Article title">
    </div>

    <div>
        <label for="content">Content</label>
        <textarea name="content" rows="4" cols="40" id="content" placeholder="Article content"></textarea>
    </div>

    <div>
        <label for="published_at">Publication date and time</label>
        <input type="datetime-local" name="published_at" id="published_at">
    </div>

    <button>Add</button>

</form>

<?php require 'includes/footer.php'; ?>
```

---

## 🔊 توضیح کد

1. **بررسی ارسال فرم:**

   ```php
   if ($_SERVER["REQUEST_METHOD"] == "POST") {
   ```

   این شرط بررسی می‌کند که آیا فرم با روش `POST` ارسال شده است یا نه.

2. **اتصال به پایگاه داده:**

   ```php
   require 'includes/database.php';
   ```

   این خط فایل اتصال به دیتابیس را فراخوانی می‌کند.

3. **ساخت دستور SQL:**

   ```php
   $sql = "INSERT INTO article (title, content, published_at) VALUES (...)";
   ```

   در این دستور داده‌های واردشده از فرم (`$_POST`) به جدول `article` اضافه می‌شود.

4. **اجرای دستور SQL:**

   ```php
   $results = mysqli_query($conn, $sql);
   ```

   با این تابع، دستور SQL در پایگاه داده اجرا می‌شود.

5. **بررسی خطا یا موفقیت:**
   اگر اجرا ناموفق باشد، خطای MySQL چاپ می‌شود.
   در غیر این صورت، با استفاده از تابع `mysqli_insert_id()` شناسه (id) رکورد جدید نمایش داده می‌شود.

6. **فرم HTML:**
   فرم شامل سه ورودی است:

   * `title` برای عنوان مقاله
   * `content` برای متن مقاله
   * `published_at` برای تاریخ و زمان انتشار

---

## 🔍 فهم مفاهیم مهم

| مفهوم                | توضیح                                                       |
| -------------------- | ----------------------------------------------------------- |
| `$_POST`             | آرایه‌ای که داده‌های ارسال‌شده با فرم را در خود نگه می‌دارد |
| `mysqli_query()`     | اجرای دستورات SQL بر روی دیتابیس                            |
| `mysqli_error()`     | نمایش خطای MySQL در صورت بروز مشکل                          |
| `mysqli_insert_id()` | بازگرداندن id رکورد جدیدی که درج شده                        |

---

## 💡 نکات مهم برای امنیت

🔸 ترکیب مستقیم مقادیر `$_POST` در SQL می‌تواند باعث **SQL Injection** شود.

🔸 در مراحل بعدی یاد می‌گیریم که با استفاده از **Prepared Statements** کد را امن کنیم.

---

## 🤔 تمرین

1. فرمی بسازید که به جدول `students` داده اضافه کند (اسم، نام خانوادگی، نمره).
2. به جای متغیر `$_POST` از یک دیکشنری ثابت برای آزمایش داخل کد استفاده کنید.
3. تغییر دهید تا بعد از افزودن داده، به صفحه `index.php` برگردد.
4. داده‌های فرم را پیش از ارسال بازبینی (والیدیشن) کنید.
